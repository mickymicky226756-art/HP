<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HP Quantum</title>

    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/6062/6062646.png" type="image/png">

    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics-compat.js"></script>
    
    <style>
        /* --- FUTURISTIC THEME VARIABLES --- */
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --deep-bg: #050510;
            --card-bg: rgba(20, 20, 35, 0.7);
            --glass: rgba(255, 255, 255, 0.05);
            --border: 1px solid rgba(0, 243, 255, 0.2);
            --text-main: #ffffff;
            --text-dim: #a0a0b0;
            --gradient: linear-gradient(90deg, #00f3ff, #bc13fe);
            --neon-green: #39ff14;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--deep-bg);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(188, 19, 254, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 243, 255, 0.1) 0%, transparent 20%);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        h1, h2, h3 { font-family: 'Orbitron', sans-serif; letter-spacing: 1px; margin: 0; }
        
        /* --- ANIMATIONS --- */
        @keyframes glow { 0% { box-shadow: 0 0 5px var(--neon-blue); } 50% { box-shadow: 0 0 20px var(--neon-blue), 0 0 10px var(--neon-purple); } 100% { box-shadow: 0 0 5px var(--neon-blue); } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 25px var(--neon-green); } 100% { transform: scale(1); } }

        /* --- AUTH SCREEN --- */
        #authSection {
            height: 100vh; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; padding: 20px;
            position: relative; overflow: hidden;
        }
        
        .particle { position: absolute; width: 2px; height: 2px; background: var(--neon-blue); border-radius: 50%; }

        .auth-card {
            background: rgba(10, 10, 20, 0.8);
            backdrop-filter: blur(20px);
            border: var(--border);
            padding: 40px 30px; border-radius: 20px;
            width: 100%; max-width: 400px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            text-align: center;
            z-index: 10;
        }

        .logo-box {
            width: 80px; height: 80px; margin: 0 auto 20px;
            background: linear-gradient(135deg, #111, #222);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            border: 2px solid var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
        }
        .logo-box i { font-size: 40px; color: var(--text-main); }

        .neon-input {
            width: 100%; background: rgba(255,255,255,0.05);
            border: 1px solid #333; color: white;
            padding: 15px; margin-bottom: 15px;
            border-radius: 8px; font-family: 'Rajdhani', sans-serif;
            font-size: 1.1em; transition: 0.3s;
        }
        .neon-input:focus { border-color: var(--neon-blue); box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }

        /* ROBOT CHECKBOX STYLES */
        .recaptcha-box {
            background: #f1f1f1;
            border: 1px solid #d3d3d3;
            border-radius: 4px;
            padding: 10px;
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin-left: auto; margin-right: auto;
        }
        .recaptcha-check {
            width: 28px; height: 28px;
            background: white;
            border: 2px solid #c1c1c1;
            border-radius: 4px;
            margin-right: 12px;
            display: flex; align-items: center; justify-content: center;
        }
        .recaptcha-check.active { border-color: transparent; }
        .recaptcha-check i { display: none; color: #009900; font-size: 18px; }
        .recaptcha-check.active i { display: block; }
        .recaptcha-text { color: #555; font-family: sans-serif; font-size: 14px; font-weight: normal; }
        
        /* ROBOT POPUP STYLES */
        .captcha-display-box {
            background: #222;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 32px;
            letter-spacing: 8px;
            font-weight: bold;
            color: var(--neon-blue);
            text-decoration: line-through;
            border: 1px solid var(--neon-purple);
            position: relative;
            overflow: hidden;
            text-shadow: 2px 2px 5px rgba(255,255,255,0.2);
            user-select: none;
        }
        .captcha-display-box::before {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
        }

        .btn-cyber {
            width: 100%; padding: 15px;
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
            font-weight: bold; text-transform: uppercase;
            cursor: pointer; position: relative; overflow: hidden;
            transition: 0.3s;
        }
        .btn-cyber::before {
            content: ''; position: absolute; top: 0; left: -100%;
            width: 100%; height: 100%; background: var(--neon-blue);
            transition: 0.3s; z-index: -1;
        }
        .btn-cyber:hover { color: #000; }
        .btn-cyber:hover::before { left: 0; }
        
        .switch-link { margin-top: 15px; font-size: 0.9em; color: var(--text-dim); cursor: pointer; text-decoration: underline; }

        /* --- APP CONTAINER --- */
        .app-container { max-width: 500px; margin: 0 auto; padding-bottom: 90px; min-height: 100vh; display: none; }

        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px; background: rgba(5, 5, 16, 0.9);
            position: sticky; top: 0; z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
        }
        .brand { font-size: 1.2em; font-weight: 700; color: var(--neon-blue); }
        .user-id { font-size: 0.8em; color: var(--neon-purple); border: 1px solid var(--neon-purple); padding: 2px 8px; border-radius: 4px; }

        .hud-display {
            margin: 20px; padding: 25px;
            background: linear-gradient(135deg, rgba(20,20,30,0.9), rgba(0,0,0,0.9));
            border: 1px solid var(--neon-purple);
            border-radius: 15px; position: relative;
            box-shadow: 0 0 20px rgba(188, 19, 254, 0.15);
        }
        .hud-display::after {
            content: 'HP-QUANTUM'; position: absolute; top: 10px; right: 10px;
            font-size: 0.6em; color: rgba(255,255,255,0.2); font-family: 'Orbitron';
        }
        .balance-label { color: var(--text-dim); font-size: 0.9em; letter-spacing: 1px; }
        .balance-val { font-size: 2.5em; font-weight: 700; color: white; text-shadow: 0 0 10px var(--neon-blue); }

        .hex-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin: 20px 10px; }
        .hex-item {
            width: 80px; height: 90px;
            background: rgba(255,255,255,0.05);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .hex-item:hover { background: var(--neon-blue); color: black; transform: scale(1.1); }
        .hex-item i { font-size: 1.5em; margin-bottom: 5px; }
        .hex-item span { font-size: 0.7em; font-weight: bold; }

        .btn-my-hp {
            display: block; width: 90%; margin: 10px auto 20px;
            background: rgba(57, 255, 20, 0.1);
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            padding: 12px; border-radius: 8px;
            font-family: 'Orbitron'; text-align: center;
            cursor: pointer; transition: 0.3s;
        }
        .btn-my-hp:hover { background: var(--neon-green); color: black; box-shadow: 0 0 15px var(--neon-green); }

        /* --- MARQUEE STYLES --- */
        .withdrawal-marquee-container {
            width: 90%;
            margin: 10px auto;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--neon-purple);
            border-radius: 8px;
            overflow: hidden;
            white-space: nowrap;
            padding: 10px 0;
            position: relative;
        }
        .marquee-track {
            display: inline-block;
            animation: marqueeScroll 25s linear infinite;
            padding-left: 100%;
        }
        .marquee-item {
            display: inline-block;
            color: white;
            margin-right: 30px;
            font-size: 0.9em;
            font-family: 'Rajdhani', sans-serif;
        }
        .marquee-item span { color: var(--neon-green); font-weight: bold; }
        @keyframes marqueeScroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- SLIDESHOW STYLES --- */
        .slideshow-container {
            position: relative;
            max-width: 100%;
            margin: 0 15px 15px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            background: rgba(0,0,0,0.5);
        }
        .mySlides { display: none; }
        .slide-img { width: 100%; height: 220px; object-fit: cover; }
        
        .slide-text-box {
            padding: 15px;
            background: linear-gradient(0deg, rgba(0,0,0,1) 0%, rgba(20,20,35,0.9) 100%);
            border-top: 2px solid var(--neon-purple);
            text-align: left;
        }
        .slide-title {
            color: var(--neon-blue);
            font-family: 'Orbitron';
            font-size: 1.1em;
            margin-bottom: 8px;
            display: flex; align-items: center;
        }
        .slide-desc {
            color: #ccc;
            font-size: 0.85em;
            line-height: 1.5;
            font-family: 'Rajdhani', sans-serif;
        }
        
        /* Fade animation */
        .fade {
            animation-name: fade;
            animation-duration: 1.5s;
        }
        @keyframes fade {
            from {opacity: .4} 
            to {opacity: 1}
        }

        /* --- PARTNER & PROMO STYLES --- */
        .home-promo-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin: 0 15px 15px;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }
        .home-promo-card h3 { color: white; font-size: 1.1em; margin-bottom: 10px; border-left: 3px solid var(--neon-blue); padding-left: 10px; }
        .home-promo-card p { color: var(--text-dim); font-size: 0.85em; line-height: 1.4; margin-bottom: 10px; }
        .partner-row { display: flex; justify-content: space-around; align-items: center; background: white; padding: 10px; border-radius: 5px; }
        .partner-logo { height: 25px; opacity: 0.8; filter: grayscale(100%); }

        .section-header { padding: 0 20px; display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .line { height: 2px; flex-grow: 1; background: linear-gradient(90deg, var(--neon-blue), transparent); }
        
        .plan-card {
            background: var(--card-bg); margin: 0 20px 15px;
            border-radius: 10px; border-left: 4px solid var(--neon-blue);
            padding: 15px; display: flex; align-items: center;
            transition: 0.3s; animation: slideUp 0.5s ease;
        }
        .plan-card:hover { transform: translateX(5px); border-left-color: var(--neon-purple); }
        .plan-icon { font-size: 2em; color: var(--text-dim); margin-right: 15px; }
        
        /* Product Card */
        .product-card {
            flex-direction: column !important; align-items: flex-start !important;
            padding: 0 !important; overflow: hidden;
        }
        .product-card .plan-img {
            width: 100% !important; height: 180px !important;
            border-radius: 0 !important; margin: 0 !important;
            border: none !important; border-bottom: 1px solid var(--neon-blue) !important;
        }
        .product-info-box { padding: 15px; width: 100%; }
        .product-btn-box { padding: 0 15px 15px 15px; width: 100%; }
        .plan-img { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; margin-right: 15px; border: 1px solid var(--neon-blue); background: #000; }

        .plan-info { flex-grow: 1; }
        .plan-title { font-weight: bold; font-size: 1.1em; color: white; }
        .plan-roi { color: var(--neon-blue); font-size: 0.9em; }
        .btn-buy {
            background: var(--neon-purple); color: white;
            border: none; padding: 8px 15px; border-radius: 4px;
            cursor: pointer; font-family: 'Rajdhani'; font-weight: bold;
        }
        .btn-buy-full { width: 100%; padding: 12px; font-size: 1.1em; }

        /* SERVICE PAGE STYLES */
        .service-btn {
            display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--neon-blue);
            padding: 20px; border-radius: 10px; margin: 0 20px 15px;
            color: white; font-size: 1.2em; cursor: pointer; transition: 0.3s;
        }
        .service-btn:hover { background: var(--neon-blue); color: black; }
        .service-btn i { font-size: 1.5em; margin-right: 10px; }
        
        .faq-item {
            background: #111; margin: 0 20px 10px; padding: 15px;
            border-radius: 8px; font-size: 0.9em; border-bottom: 1px solid #333;
        }

        /* Bottom Nav */
        .nav-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 450px;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 50px; height: 65px;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .nav-item {
            color: var(--text-dim); font-size: 1.2em;
            position: relative; cursor: pointer; transition: 0.3s;
            width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%;
        }
        .nav-item.active { background: var(--neon-blue); color: black; box-shadow: 0 0 15px var(--neon-blue); transform: translateY(-10px); }

        /* Overlays & Toast */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000;
            display: none; padding: 20px; overflow-y: auto;
        }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 2em; color: white; cursor: pointer; z-index: 2001; }
        .modal-content { margin-top: 60px; text-align: center; }
        .crypto-box { background: white; color: black; padding: 20px; border-radius: 10px; margin: 20px 0; font-family: monospace; }

        #toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            background: var(--neon-blue); color: black;
            padding: 10px 20px; border-radius: 4px; font-weight: bold;
            z-index: 5000; opacity: 0; transition: 0.5s; pointer-events: none;
        }
        #toast.show { opacity: 1; top: 40px; }

        /* ADMIN PANEL */
        .admin-box { background: #1a1a2e; padding: 15px; margin-bottom: 10px; border: 1px solid #333; }
        .plan-item-admin { display:flex; justify-content:space-between; align-items:center; background:#111; padding:10px; margin-bottom:5px; font-size:0.9em; }
        .btn-adm-edit { background: var(--neon-blue); color:black; border:none; padding:5px 10px; cursor:pointer; font-weight:bold; }
        .btn-adm-del { background: #ff3333; color:white; border:none; padding:5px 10px; cursor:pointer; font-weight:bold; }
        .btn-adm-approve { background: var(--neon-green); color:black; border:none; padding:5px 10px; cursor:pointer; font-weight:bold; margin-right: 5px; }
        
        /* TEAM TAB HIGHLIGHTS */
        .team-tab-item { transition: 0.3s; flex: 1; text-align: center; font-size: 0.9em; }
        .team-tab-item.active-tab { color: var(--neon-blue) !important; font-weight:bold; border-bottom: 2px solid var(--neon-blue) !important; }

        /* TEAM STATS */
        .stats-box { display:flex; justify-content:space-between; margin-top:15px; border-top:1px solid rgba(255,255,255,0.1); padding-top:10px; }
        .stat-item { text-align:center; flex:1; border-right: 1px solid #333; }
        .stat-item:last-child { border-right: none; }
        .stat-label { font-size:0.7em; color:var(--text-dim); }
        .stat-val { font-weight:bold; color:var(--neon-blue); font-size:0.9em; }

        /* HISTORY TABS */
        .trans-section { margin-bottom: 30px; }
        .trans-header { display:flex; align-items:center; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px; }
        .trans-header i { margin-right:10px; }

        /* --- TASK PAGE STYLES --- */
        .task-progress-box {
            text-align: center; padding: 30px 20px;
            background: radial-gradient(circle, rgba(20,20,40,0.8), rgba(0,0,0,1));
            border-radius: 20px; border: 1px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.1);
            position: relative; overflow: hidden;
        }
        .task-progress-box::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.03), transparent);
            animation: spin 5s linear infinite; pointer-events: none;
        }
        @keyframes spin { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }

        .circle-loader {
            width: 140px; height: 140px; border-radius: 50%;
            background: conic-gradient(var(--neon-blue) var(--percent), #333 0);
            margin: 0 auto 20px; display: flex; align-items: center; justify-content: center;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            transition: 1s ease-in-out;
        }
        .circle-inner {
            width: 120px; height: 120px; background: #050510; border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .percent-text { font-size: 2em; font-weight: 900; color: white; font-family: 'Orbitron'; }
        
        .reward-card {
            background: linear-gradient(90deg, rgba(188,19,254,0.1), rgba(0,243,255,0.1));
            border: 1px solid var(--neon-purple); border-radius: 10px; padding: 15px;
            margin: 20px 0; text-align: center;
        }
        .reward-amount { font-size: 2.2em; font-weight: bold; color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); font-family: 'Orbitron'; }

        .btn-claim {
            width: 100%; padding: 15px; border-radius: 50px; border: none;
            background: #333; color: #777; font-weight: bold; font-family: 'Orbitron'; font-size: 1.2em;
            cursor: not-allowed; transition: 0.3s;
        }
        .btn-claim.active {
            background: var(--neon-green); color: black; cursor: pointer;
            box-shadow: 0 0 20px var(--neon-green); animation: pulseBtn 2s infinite;
        }

    </style>
</head>
<body>

    <div id="toast">Notification</div>

    <div id="authSection">
        <div class="auth-card">
            <div class="logo-box"><i class="fas fa-microchip"></i></div>
            <h2 style="color:white; margin-bottom:5px;">HP QUANTUM</h2>
            <p style="color:var(--text-dim); font-size:0.8em; margin-bottom:25px;">Future of Tech Investment</p>
            
            <p id="authMsg" style="color:#ff3333; font-size:0.9em;"></p>

            <form id="authForm">
                <input type="number" id="authPhone" class="neon-input" placeholder="ACCESS ID (Phone)" required>
                <input type="password" id="authPass" class="neon-input" placeholder="SECURITY KEY (Password)" required>
                <input type="password" id="authConf" class="neon-input" placeholder="CONFIRM KEY" style="display:none;">
                <input type="text" id="authRef" class="neon-input" placeholder="REFERRAL CODE" style="display:none;">
                
                <div class="recaptcha-box" onclick="openRobotCheck()">
                    <div id="humanCheck" class="recaptcha-check">
                        <i class="fas fa-check"></i>
                    </div>
                    <span class="recaptcha-text">I'm not a robot</span>
                    <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" style="width:24px; margin-left:auto; opacity:0.5;">
                </div>

                <button type="submit" class="btn-cyber" id="authBtn">INITIALIZE LOGIN</button>
            </form>
            
            <div class="switch-link" onclick="toggleAuth()"><span id="switchTxt">Request Access (Register)</span></div>
        </div>
    </div>

    <div id="robotOverlay" class="overlay">
        <div class="modal-content" style="max-width:350px; margin: 100px auto; background:rgba(20,20,30,0.95); padding:25px; border-radius:15px; border:1px solid var(--neon-blue);">
            <h3 style="color:var(--neon-blue); margin-bottom:10px;">SECURITY CHECK</h3>
            <p style="color:#aaa; font-size:0.9em; margin-bottom:20px;">Type the code below to prove you are human.</p>
            
            <div id="visualCode" class="captcha-display-box">A7B2</div>
            
            <input type="text" id="robotInput" class="neon-input" placeholder="Enter code here" style="text-align:center; font-size:1.2em; letter-spacing:3px;">
            
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button type="button" class="btn-cyber" style="border-color:#555; color:#aaa;" onclick="generateVisualCaptcha()">REFRESH</button>
                <button type="button" class="btn-cyber" style="background:var(--neon-blue); color:black;" onclick="verifyRobot()">VERIFY</button>
            </div>
        </div>
    </div>

    <div id="appContainer" class="app-container">
        
        <div class="top-bar">
            <div class="brand"><i class="fas fa-bolt"></i> HP-Q</div>
            <div class="user-id" id="displayRef">ID: ---</div>
        </div>

        <div id="pageHome" class="page-section">
            <div class="hud-display">
                <div class="balance-label">TOTAL ASSETS</div>
                <div class="balance-val"><span id="userBal">0.00</span> <span style="font-size:0.4em;">ETB</span></div>
                <div style="margin-top:10px; font-size:0.8em; color:var(--neon-blue);">
                    <i class="fas fa-arrow-up"></i> <span id="dailyRev">0.00</span> Today's Yield
                </div>
            </div>

            <div class="hex-grid">
                <div class="hex-item" onclick="openDeposit()">
                    <i class="fas fa-wallet" style="color:#00f3ff;"></i>
                    <span>Deposit</span>
                </div>
                <div class="hex-item" onclick="openWithdraw()">
                    <i class="fas fa-hand-holding-usd" style="color:#bc13fe;"></i>
                    <span>Withdraw</span>
                </div>
                <div class="hex-item" onclick="dailyCheckIn()">
                    <i class="fas fa-calendar-check" style="color:#ffcc00;"></i>
                    <span>Check-In</span>
                </div>
                <div class="hex-item" onclick="openOverlay('giftOverlay')">
                    <i class="fas fa-gift" style="color:#ff3333;"></i>
                    <span>Gift</span>
                </div>
            </div>

            <div class="withdrawal-marquee-container">
                <div class="marquee-track" id="withdrawTicker">
                    <span style="color:#888;">Connecting to payout server...</span>
                </div>
            </div>

            <div class="btn-my-hp" onclick="openMyPlans()">
                <i class="fas fa-microchip"></i> My HP (Active Nodes)
            </div>
            
            <div class="slideshow-container">
                
                <div class="mySlides fade">
                    <img src="https://images.unsplash.com/photo-1518770660439-4636190af475?q=80&w=1400&auto=format&fit=crop" class="slide-img">
                    <div class="slide-text-box">
                        <div class="slide-title"><i class="fas fa-server" style="margin-right:10px;"></i> QUANTUM SERVERS</div>
                        <div class="slide-desc">Our state-of-the-art data centers in Switzerland provide 99.9% uptime, ensuring maximum daily returns for all node operators.</div>
                    </div>
                </div>

                <div class="mySlides fade">
                    <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?q=80&w=1400&auto=format&fit=crop" class="slide-img">
                    <div class="slide-text-box">
                        <div class="slide-title"><i class="fas fa-shield-alt" style="margin-right:10px; color:var(--neon-green);"></i> MILITARY SECURITY</div>
                        <div class="slide-desc">Your assets are protected by advanced cryptographic algorithms and real-time AI threat monitoring systems.</div>
                    </div>
                </div>

                <div class="mySlides fade">
                    <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1400&auto=format&fit=crop" class="slide-img">
                    <div class="slide-text-box">
                        <div class="slide-title"><i class="fas fa-globe" style="margin-right:10px; color:var(--neon-purple);"></i> GLOBAL NETWORK</div>
                        <div class="slide-desc">Join a decentralized network connecting investors to enterprise-grade cloud computing needs worldwide.</div>
                    </div>
                </div>

            </div>
            <div class="home-promo-card" style="border-color: var(--neon-purple);">
                <h3 style="border-color: var(--neon-purple);">STRATEGIC PARTNERS</h3>
                <p>Collaborating with global tech giants to ensure stability.</p>
                <div class="partner-row">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Tesla_logo.png/1200px-Tesla_logo.png" class="partner-logo" alt="Tesla">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/1200px-Google_2015_logo.svg.png" class="partner-logo" alt="Google">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/IBM_logo.svg/1200px-IBM_logo.svg.png" class="partner-logo" alt="IBM">
                </div>
            </div>
            
            <div style="padding: 0 15px 15px;">
                <button class="btn-cyber" onclick="window.location.href='hp.apk'" style="background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple)); color: white; border: none; box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);">
                    <i class="fab fa-android" style="margin-right:10px;"></i> DOWNLOAD APP
                </button>
            </div>
            
        </div>

        <div id="pageInvest" class="page-section hidden">
            <div style="text-align:center; padding:30px 20px 10px;">
                <i class="fas fa-cubes" style="font-size:50px; color:var(--neon-blue); margin-bottom:10px;"></i>
                <h2>QUANTUM MARKET</h2>
                <p style="color:#888;">Rent High-Performance Nodes</p>
            </div>
            <div class="section-header">
                <h3>SERVER NODES</h3> <div class="line"></div>
            </div>
            <div id="plansList">
                <p style="text-align:center; color:#666;">Connecting to mainframe...</p>
            </div>
        </div>

        <div id="pageTeam" class="page-section hidden">
            <div class="hud-display" style="border-color: var(--neon-blue);">
                <div class="balance-label">NETWORK COMMISSION</div>
                <div class="balance-val"><span id="teamBal">0.00</span> <span style="font-size:0.4em;">ETB</span></div>
                
                <button onclick="copyRef()" style="width:100%; margin-top:10px; background:transparent; border:1px solid white; color:white; padding:5px 10px; border-radius:5px;">
                    Copy Link <i class="fas fa-link"></i>
                </button>

                <div class="stats-box">
                    <div class="stat-item">
                        <div class="stat-label">L1</div>
                        <div id="countL1" class="stat-val">0/0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">L2</div>
                        <div id="countL2" class="stat-val">0/0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">L3</div>
                        <div id="countL3" class="stat-val">0/0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">L4</div>
                        <div id="countL4" class="stat-val">0/0</div>
                    </div>
                </div>
            </div>
            
            <div style="padding:20px;">
                <div style="display:flex; justify-content:space-around; margin-bottom:20px;">
                    <div id="tabL1" class="team-tab-item" onclick="loadTeam(1)" style="cursor:pointer; color:var(--text-dim); padding-bottom:5px;">L-1</div>
                    <div id="tabL2" class="team-tab-item" onclick="loadTeam(2)" style="cursor:pointer; color:var(--text-dim); padding-bottom:5px;">L-2</div>
                    <div id="tabL3" class="team-tab-item" onclick="loadTeam(3)" style="cursor:pointer; color:var(--text-dim); padding-bottom:5px;">L-3</div>
                    <div id="tabL4" class="team-tab-item" onclick="loadTeam(4)" style="cursor:pointer; color:var(--text-dim); padding-bottom:5px;">L-4</div>
                </div>
                <div id="teamList"></div>
            </div>
        </div>

        <div id="pageService" class="page-section hidden">
            <div style="text-align:center; padding:30px 20px;">
                <i class="fas fa-headset" style="font-size:60px; color:var(--neon-blue); margin-bottom:10px;"></i>
                <h2>SUPPORT CENTER</h2>
                <p style="color:#888;">We are here to help 24/7</p>
            </div>

            <div class="section-header">
                <h3>ABOUT HP-QUANTUM</h3> <div class="line"></div>
            </div>
            <div class="service-btn" style="border-color: var(--neon-purple);" onclick="openOverlay('aboutOverlay')">
                <i class="fas fa-info-circle" style="color: var(--neon-purple);"></i> Company Profile
            </div>
            <div class="section-header">
                <h3>CONTACT US</h3> <div class="line"></div>
            </div>

            <div class="service-btn" onclick="window.open('https://t.me/Hpnode')">
                <i class="fab fa-telegram"></i> Official Telegram
            </div>
            <div class="service-btn" onclick="window.open('https://t.me/+HHREY7OleYJiN2E0')">
                <i class="fab fa-telegram-plane"></i> Join Community
            </div>
            <div class="service-btn" style="border-color:var(--neon-green);" onclick="alert('WhatsApp Coming Soon')">
                <i class="fab fa-whatsapp"></i> WhatsApp Support
            </div>

            <div class="section-header" style="margin-top:30px;">
                <h3>FAQ</h3> <div class="line"></div>
            </div>
            
            <div class="faq-item">
                <strong style="color:var(--neon-blue);">How to Deposit?</strong><br>
                Click on the Deposit icon on the home page, select your bank, and follow instructions.
            </div>
            <div class="faq-item">
                <strong style="color:var(--neon-blue);">Minimum Withdraw?</strong><br>
                The minimum withdrawal amount is 270 ETB.
            </div>
            <div class="faq-item">
                <strong style="color:var(--neon-blue);">Recharge Bonus?</strong><br>
                L1: 10%, L2: 2%, L3: 1% (On Investment Amount).
            </div>
        </div>

        <div id="pageMe" class="page-section hidden">
            <div style="text-align:center; padding: 25px 0;">
                <div style="width: 100px; height: 100px; margin: 0 auto; border-radius: 50%; border: 2px solid var(--neon-blue); padding: 3px; box-shadow: 0 0 20px rgba(0, 243, 255, 0.3); background:black;">
                    <img src="https://cdn-icons-png.flaticon.com/512/1785/1785911.png" style="width:100%; height:100%; border-radius:50%; object-fit:cover;" alt="User Profile">
                </div>
                
                <h2 id="uLevelTitle" style="color:white; margin: 10px 0 5px 0; font-family:'Orbitron';">LEVEL 0 INVESTOR</h2>
                <div style="color:var(--text-dim); font-size:0.9em; display:inline-block; border:1px solid var(--neon-purple); padding:2px 10px; border-radius:10px;">Quantum Node Operator</div>
            </div>

            <div class="section-header" style="margin-top:20px;">
                <h3>MY DASHBOARD</h3> <div class="line"></div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:0 20px; margin-bottom:20px;">
                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; text-align:center; border:1px solid #ffcc00;">
                    <div style="font-size:0.8em; color:#aaa;">Today Income</div>
                    <div id="statToday" style="font-size:1.2em; font-weight:bold; color:#ffcc00;">0.00</div>
                </div>
                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; text-align:center; border:1px solid var(--neon-blue);">
                    <div style="font-size:0.8em; color:#aaa;">Total Comm.</div>
                    <div id="statCommMe" style="font-size:1.2em; font-weight:bold; color:var(--neon-blue);">0.00</div>
                </div>
                 <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; text-align:center; border:1px solid var(--neon-green);">
                    <div style="font-size:0.8em; color:#aaa;">Total Recharge</div>
                    <div id="statRecharge" style="font-size:1.2em; font-weight:bold; color:var(--neon-green);">0.00</div>
                </div>
                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; text-align:center; border:1px solid var(--neon-purple);">
                    <div style="font-size:0.8em; color:#aaa;">Total Withdraw</div>
                    <div id="statWithdraw" style="font-size:1.2em; font-weight:bold; color:var(--neon-purple);">0.00</div>
                </div>
            </div>
            
            <div class="section-header">
                <h3>ACTIONS</h3> <div class="line"></div>
            </div>

            <div class="hex-grid">
                <div class="hex-item" onclick="openOverlay('bankOverlay')">
                    <i class="fas fa-university" style="color:var(--neon-green);"></i>
                    <span>Bind Bank</span>
                </div>
                <div class="hex-item" onclick="openHistory()">
                    <i class="fas fa-list-alt" style="color:#ffcc00;"></i>
                    <span>History</span>
                </div>
                <div class="hex-item" onclick="openSettings()">
                    <i class="fas fa-cog" style="color:#aaa;"></i>
                    <span>Settings</span>
                </div>
                <div class="hex-item" onclick="openTasks()">
                    <i class="fas fa-tasks" style="color:white;"></i>
                    <span>Tasks</span>
                </div>
            </div>

            <div style="padding: 0 20px 20px; margin-top:20px;">
                <button onclick="logout()" style="width:100%; padding:15px; background:rgba(255, 51, 51, 0.1); border:1px solid #ff3333; color:#ff3333; border-radius:10px; font-family:'Orbitron'; font-weight:bold; cursor:pointer; transition:0.3s; display:flex; align-items:center; justify-content:center;">
                    <i class="fas fa-sign-out-alt" style="margin-right:10px;"></i> SECURE LOGOUT
                </button>
            </div>
        </div>

        <div class="nav-dock">
            <div class="nav-item active" onclick="switchPage('pageHome', this)"><i class="fas fa-home"></i></div>
            <div class="nav-item" onclick="switchPage('pageInvest', this)"><i class="fas fa-cubes"></i></div>
            <div class="nav-item" onclick="switchPage('pageTeam', this)"><i class="fas fa-network-wired"></i></div>
            <div class="nav-item" onclick="switchPage('pageService', this)"><i class="fas fa-headset"></i></div> 
            <div class="nav-item" onclick="switchPage('pageMe', this)"><i class="fas fa-user-cog"></i></div>
        </div>
    </div>

    <div id="tasksOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('tasksOverlay')">&times;</div>
        <div class="modal-content" style="padding:10px;">
            <h2 style="color: var(--neon-blue); letter-spacing:2px; margin-bottom: 20px;">MISSION CONTROL</h2>
            
            <div class="task-progress-box">
                <div class="circle-loader" id="taskLoader">
                    <div class="circle-inner">
                        <div class="percent-text" id="taskPercent">0%</div>
                        <div style="font-size:0.7em; color:#aaa;">TARGET</div>
                    </div>
                </div>
                
                <h3 style="color:white; margin-bottom:5px;">INVITE INVESTORS</h3>
                <p style="color:var(--text-dim); font-size:0.9em;">
                    Invited: <span id="taskDone" style="color:white; font-weight:bold;">0</span> / <span id="taskGoal" style="color:var(--neon-blue); font-weight:bold;">10</span>
                </p>
                <p style="font-size:0.7em; color:#666;">Note: Only users who Deposit are counted.</p>
            </div>

            <div class="reward-card">
                <div style="color:var(--neon-purple); letter-spacing:1px; font-size:0.8em;">CURRENT REWARD BOUNTY</div>
                <div class="reward-amount" id="taskRewardVal">500 ETB</div>
            </div>

            <button id="btnClaimTask" class="btn-claim" onclick="claimTaskReward()">
                <i class="fas fa-lock"></i> LOCKED
            </button>
        </div>
    </div>

    <div id="aboutOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('aboutOverlay')">&times;</div>
        <div class="modal-content" style="padding: 20px; text-align: left;">
            <h2 style="color: var(--neon-blue); text-align: center; text-transform: uppercase; letter-spacing: 2px;">HP-Quantum Architecture</h2>
            <p style="text-align: center; color: var(--neon-purple); font-size: 0.8em; margin-bottom: 20px;">EST. 2023 | SECTOR: CLOUD COMPUTING</p>
            <hr style="border-color: #333; margin-bottom: 20px;">

            <h4 style="color: white; border-left: 3px solid var(--neon-blue); padding-left: 10px;">// 1. ORIGIN & EVOLUTION</h4>
            <p style="color: #ccc; line-height: 1.6; font-size: 0.9em;">
                HP-Quantum began as a covert research initiative in Zurich. By 2024, we successfully transitioned from centralized data centers to a decentralized user-owned network.
            </p>

            <h4 style="color: white; border-left: 3px solid var(--neon-purple); padding-left: 10px; margin-top: 20px;">// 2. THE CORE MECHANISM</h4>
            <p style="color: #ccc; line-height: 1.6; font-size: 0.9em;">
                Our platform bridges the gap between hardware investors and enterprise data needs.
            </p>

            <div class="hud-display" style="border-color: var(--neon-blue); padding: 15px; margin-top: 25px; text-align: center;">
                <p style="color: white; font-weight: bold;">"We are not just building a server; we are building the nervous system of the future digital world."</p>
            </div>
        </div>
    </div>

    <div id="myPlansOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('myPlansOverlay')">&times;</div>
        <div class="modal-content">
            <h2 style="color:var(--neon-green);">MY ACTIVE NODES</h2>
            <div id="myActivePlansList" style="margin-top:20px; text-align:left;">
                <p style="text-align:center; color:#666;">Scanning system...</p>
            </div>
        </div>
    </div>

    <div id="depositOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('depositOverlay')">&times;</div>
        <div class="modal-content">
            <h2 style="color:var(--neon-blue);">ADD FUNDS</h2>
            <div id="depositMethodButtons" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:20px 0;">
                <p style="text-align:center; grid-column:span 2; color:#666;">Loading Payment Methods...</p>
            </div>
            
            <div id="bankDetails" style="display:none;">
                <div class="crypto-box">
                    <div id="depBankName">BANK</div>
                    <h1 id="depAccNum" style="margin:5px 0;">0000</h1>
                    <div id="depHolder">NAME</div>
                </div>
                <input type="number" id="depAmount" class="neon-input" placeholder="Amount (Min 900)">
                <input type="text" id="depRef" class="neon-input" placeholder="Transaction ID">
                <button class="btn-cyber" onclick="submitDeposit()">CONFIRM TRANSFER</button>
            </div>
        </div>
    </div>

    <div id="withdrawOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('withdrawOverlay')">&times;</div>
        <div class="modal-content">
            <h2 style="color:var(--neon-purple);">WITHDRAW</h2>
            <p>Available: <span id="withBal">0.00</span> ETB</p>
            <input type="number" id="withAmount" class="neon-input" placeholder="Amount (Min 270)">
            <input type="password" id="withPass" class="neon-input" placeholder="Withdrawal Password">
            <button class="btn-cyber" style="border-color:var(--neon-purple); color:var(--neon-purple);" onclick="submitWithdraw()">REQUEST PAYOUT</button>
        </div>
    </div>

    <div id="giftOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('giftOverlay')">&times;</div>
        <div class="modal-content" style="margin-top:100px;">
            <i class="fas fa-cube" style="font-size:60px; color:var(--neon-blue); animation: glow 2s infinite;"></i>
            <h2 style="margin-top:20px;">REDEEM CODE</h2>
            <input type="text" id="giftCode" class="neon-input" placeholder="ENTER PROMO CODE">
            <button class="btn-cyber" onclick="redeemGift()">DECRYPT</button>
        </div>
    </div>

    <div id="bankOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('bankOverlay')">&times;</div>
        <div class="modal-content">
            <h2>LINK ACCOUNT</h2>
            <input type="text" id="bindName" class="neon-input" placeholder="Full Name">
            <input type="number" id="bindNum" class="neon-input" placeholder="Account Number">
            <select id="bindType" class="neon-input" style="background:#111;"><option>CBE</option><option>Telebirr</option></select>
            <input type="password" id="bindWPass" class="neon-input" placeholder="Set Withdrawal Password">
            <button class="btn-cyber" onclick="saveBank()">SAVE DATA</button>
        </div>
    </div>
    
    <div id="historyOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('historyOverlay')">&times;</div>
        <div class="modal-content" style="text-align: left; padding: 0 10px;">
            <h2 style="color:#ffcc00; text-align: center;">TRANSACTIONS</h2>
            
            <div class="trans-section">
                <div class="trans-header">
                    <i class="fas fa-arrow-down" style="color:var(--neon-green);"></i>
                    <h3 style="color:var(--neon-green);">Deposits</h3>
                </div>
                <div id="list-deposits"></div>
            </div>

            <div class="trans-section">
                <div class="trans-header">
                    <i class="fas fa-arrow-up" style="color:var(--neon-purple);"></i>
                    <h3 style="color:var(--neon-purple);">Withdrawals</h3>
                </div>
                <div id="list-withdrawals"></div>
            </div>

            <div class="trans-section">
                <div class="trans-header">
                    <i class="fas fa-microchip" style="color:var(--neon-blue);"></i>
                    <h3 style="color:var(--neon-blue);">Investments</h3>
                </div>
                <div id="list-investments"></div>
            </div>

        </div>
    </div>

    <div id="settingsOverlay" class="overlay">
        <div class="close-btn" onclick="closeOverlay('settingsOverlay')">&times;</div>
        <div class="modal-content">
            <h2 style="color:var(--text-dim);">SETTINGS</h2>
            
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-bottom:20px;">
                <h4 style="color:var(--neon-blue); margin-top:0;">LOGIN SECURITY</h4>
                <input type="password" id="setOldPass" class="neon-input" placeholder="Current Password">
                <input type="password" id="setNewPass" class="neon-input" placeholder="New Password">
                <button class="btn-cyber" onclick="changeLoginPass()">UPDATE LOGIN KEY</button>
            </div>

            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px;">
                <h4 style="color:var(--neon-purple); margin-top:0;">WITHDRAWAL SECURITY</h4>
                <input type="password" id="setNewWPass" class="neon-input" placeholder="New Withdrawal Password">
                <button class="btn-cyber" style="border-color:var(--neon-purple); color:var(--neon-purple);" onclick="changeWPass()">SET PIN</button>
            </div>
        </div>
    </div>

    <div id="adminPanel" class="overlay" style="background:#000;">
        <div class="close-btn" onclick="closeOverlay('adminPanel')">&times;</div>
        <div style="padding:20px; margin-top:50px;">
            <h1 style="color:red; text-align:center;">MASTER CONTROL</h1>
            
            <div class="admin-box">
                <h4 style="color:#ff3333;">Pending Withdrawals</h4>
                <div id="admWithList"></div>
            </div>

            <div class="admin-box">
                <h4 style="color:var(--neon-green);">Pending Deposits</h4>
                <div id="admDepList"></div>
            </div>

            <div class="admin-box">
                <h4 style="color:#ff3333;">Gift Code Generator</h4>
                <input id="admGiftAmt" placeholder="Amount (ETB)" class="neon-input" type="number">
                <button onclick="admGenGift()" class="btn-buy" style="background:#ff3333; width:100%;">Generate Code</button>
                <div id="admGiftList" style="margin-top:10px; font-size:0.9em;"></div>
            </div>

            <div class="admin-box">
                <h4 style="color:var(--neon-blue);">Manage Payment Methods</h4>
                <input id="admBankName" placeholder="Bank Name (e.g. CBE, Telebirr)" class="neon-input">
                <input id="admBankNum" placeholder="Account Number" class="neon-input">
                <input id="admBankHolder" placeholder="Account Holder Name" class="neon-input">
                <button onclick="admAddBank()" class="btn-buy" style="width:100%; margin-top:5px;">Add Payment Method</button>
                <div id="admBankList" style="margin-top:10px; font-size:0.8em; color:#888;"></div>
            </div>

            <div class="admin-box">
                <h4 style="color:var(--neon-green);">Manage Plans</h4>
                <p style="font-size:0.8em; color:#888;">Fill form to Add New or Click Edit on existing.</p>
                <input id="admName" placeholder="Plan Name" class="neon-input">
                <input id="admImg" placeholder="Image URL (http...)" class="neon-input">
                <input id="admPrice" placeholder="Price (ETB)" class="neon-input">
                <input id="admDaily" placeholder="Daily Return (ETB)" class="neon-input">
                <input id="admDays" placeholder="Plan Duration (Days)" class="neon-input" type="number">
                <input id="admLimit" placeholder="Purchase Limit (0 = Unlimited)" class="neon-input" type="number">
                
                <button onclick="admAddPlan()" id="btnSavePlan" class="btn-buy" style="background:var(--neon-green); width:100%;">Add New Plan</button>
                <button onclick="admCancelEdit()" id="btnCancelEdit" class="btn-buy" style="background:#333; width:100%; margin-top:5px; display:none;">Cancel Edit</button>

                <div id="admPlansList" style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                    </div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyB1fIBSBwXGPxhE5p0YhR0ThVJwOS0_JYc",
            authDomain: "hpin-d4018.firebaseapp.com",
            databaseURL: "https://hpin-d4018-default-rtdb.firebaseio.com",
            projectId: "hpin-d4018",
            storageBucket: "hpin-d4018.firebasestorage.app",
            messagingSenderId: "265754707424",
            appId: "1:265754707424:web:308991588fa20c5ac61785",
            measurementId: "G-RRN0X34KPC"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const analytics = firebase.analytics();

        // --- 2. CORE VARIABLES ---
        let currentUser = null;
        let isLogin = true;
        let selectedBankData = null;
        let editingPlanId = null;
        
        // Task Variables
        let taskRewardAmount = 0;
        let taskIsReady = false;

        // --- 3. ROBOT / CAPTCHA LOGIC ---
        let isHuman = false;
        let generatedCode = "";

        function openRobotCheck() {
            if (isHuman) return; // Already verified
            
            // MODIFIED: Direct verification (No popup/text)
            isHuman = true;
            document.getElementById('humanCheck').classList.add('active');
            
            // Commented out original popup logic
            // generateVisualCaptcha();
            // openOverlay('robotOverlay');
        }

        function generateVisualCaptcha() {
            // Generate random 4 digit string/number
            const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
            let result = "";
            for(let i=0; i<4; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            generatedCode = result;
            
            // Display with spaces and some randomness in DOM
            document.getElementById('visualCode').innerText = result.split('').join(' ');
            document.getElementById('robotInput').value = "";
        }

        function verifyRobot() {
            const userInput = document.getElementById('robotInput').value.toUpperCase().replace(/\s/g, '');
            if (userInput === generatedCode) {
                isHuman = true;
                document.getElementById('humanCheck').classList.add('active');
                closeOverlay('robotOverlay');
                showToast("Verification Success");
            } else {
                showToast("Incorrect Code. Try Again.");
                generateVisualCaptcha();
            }
        }

        // --- 4. AUTH LOGIC ---
        function toggleAuth() {
            isLogin = !isLogin;
            document.getElementById('authBtn').innerText = isLogin ? "INITIALIZE LOGIN" : "CREATE ACCOUNT";
            document.getElementById('switchTxt').innerText = isLogin ? "Request Access (Register)" : "Have ID? Login";
            document.getElementById('authConf').style.display = isLogin ? 'none' : 'block';
            document.getElementById('authRef').style.display = isLogin ? 'none' : 'block';
            
            // Reset verification on switch
            isHuman = false;
            document.getElementById('humanCheck').classList.remove('active');
        }

        // --- CHECK REFERRAL ON LOAD ---
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const refParam = urlParams.get('ref');

            if (refParam) {
                // Force switch to Register Mode
                isLogin = false;
                document.getElementById('authBtn').innerText = "CREATE ACCOUNT";
                document.getElementById('switchTxt').innerText = "Have ID? Login";
                document.getElementById('authConf').style.display = 'block';
                document.getElementById('authRef').style.display = 'block';

                // Auto-fill and Lock Ref Code
                document.getElementById('authRef').value = refParam;
                document.getElementById('authRef').setAttribute('readonly', true);
                document.getElementById('authRef').style.opacity = "0.7";
            }
        });

        document.getElementById('authForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const phone = document.getElementById('authPhone').value;
            const pass = document.getElementById('authPass').value;
            
            // ROBOT VERIFICATION CHECK
            if (!isHuman) {
                showToast("Please Verify You Are Not A Robot");
                return;
            }

            // ADMIN BACKDOOR
            if(phone === '44' && pass === 'a444') {
                openOverlay('adminPanel');
                loadAdminData();
                return;
            }

            const uid = "u_" + phone;

            if(isLogin) {
                db.ref('users/' + uid).once('value', snap => {
                    if(snap.exists() && snap.val().pass === pass) {
                        enterApp(snap.val());
                    } else {
                        showToast("ACCESS DENIED");
                        // Reset robot check on failure to prevent spam
                        isHuman = false;
                        document.getElementById('humanCheck').classList.remove('active');
                    }
                });
            } else {
                if(pass !== document.getElementById('authConf').value) { showToast("Key Mismatch"); return; }
                
                db.ref('users/' + uid).once('value', snap => {
                    if(snap.exists()) { showToast("User Exists"); return; }
                    
                    const newUser = {
                        phone: phone,
                        pass: pass,
                        balance: 100, // UPDATED: 100 ETB Bonus
                        refCode: Math.random().toString(36).substring(2,8).toUpperCase(),
                        refBy: document.getElementById('authRef').value || "ROOT",
                        joinDate: Date.now(),
                        totalDep: 0,
                        totalWith: 0,
                        today: 0,
                        taskLevel: 0 // New field for tasks
                    };

                    db.ref('users/' + uid).set(newUser).then(() => {
                        showToast("ACCOUNT CREATED +100 ETB"); // UPDATED MSG
                        enterApp(newUser);
                    });
                });
            }
        });

        function enterApp(user) {
            currentUser = user;
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            db.ref('users/u_' + user.phone).on('value', snap => {
                currentUser = snap.val();
                updateUI();
            });
            
            loadPlans();
            loadDepositMethods();
            loadWithdrawTicker(); // Start Ticker
            showSlides(); // Start Slideshow
        }

        // --- SLIDESHOW LOGIC ---
        let slideIndex = 0;
        function showSlides() {
            let i;
            let slides = document.getElementsByClassName("mySlides");
            if(slides.length === 0) return; // Guard clause
            
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";  
            }
            slideIndex++;
            if (slideIndex > slides.length) {slideIndex = 1}    
            slides[slideIndex-1].style.display = "block";  
            setTimeout(showSlides, 4000); // Change image every 4 seconds
        }

        // --- MARQUEE LOGIC ---
        function loadWithdrawTicker() {
            const track = document.getElementById('withdrawTicker');
            // Listen for withdrawals where status is 'paid' (approved)
            db.ref('withdrawals').orderByChild('status').equalTo('paid').limitToLast(10).on('value', snap => {
                if(!snap.exists()) return;
                
                track.innerHTML = "";
                const data = [];
                snap.forEach(s => data.push(s.val()));
                
                // Duplicate data to make scroll look continuous if few items
                const displayData = [...data.reverse(), ...data]; 

                displayData.forEach(w => {
                    // Mask phone number for privacy
                    let phone = w.uid.replace('u_', '');
                    let masked = phone.substring(0, 4) + "***" + phone.substring(phone.length - 2);
                    
                    track.innerHTML += `
                        <div class="marquee-item">
                            <i class="fas fa-check-circle" style="color:var(--neon-green)"></i> 
                            User ${masked} withdraw <span>${w.amount} ETB</span>
                        </div>
                    `;
                });
            });
        }

        function updateUI() {
            document.getElementById('userBal').innerText = currentUser.balance.toFixed(2);
            document.getElementById('withBal').innerText = currentUser.balance.toFixed(2);
            document.getElementById('displayRef').innerText = "ID: " + currentUser.refCode;
            document.getElementById('teamBal').innerText = (currentUser.comm || 0).toFixed(2);

            // UPDATED PROFILE STATS
            document.getElementById('statToday').innerText = (currentUser.today || 0).toFixed(2);
            document.getElementById('statCommMe').innerText = (currentUser.comm || 0).toFixed(2);
            document.getElementById('statRecharge').innerText = (currentUser.totalDep || 0).toFixed(2);
            document.getElementById('statWithdraw').innerText = (currentUser.totalWith || 0).toFixed(2);

            // --- LEVEL CALCULATION LOGIC ---
            // Based on Total Recharge (Investment)
            let myInv = currentUser.totalDep || 0;
            let lvl = 0;

            if (myInv >= 1000 && myInv < 4000) {
                lvl = 1;
            } else if (myInv >= 4000 && myInv < 10000) {
                lvl = 2;
            } else if (myInv >= 10000) {
                // Base is 3, add 1 for every additional 10k
                lvl = 3 + Math.floor((myInv - 10000) / 10000);
            }

            document.getElementById('uLevelTitle').innerText = `LEVEL ${lvl} INVESTOR`;
            // --------------------------------
        }

        function logout() { location.reload(); }

        // --- 4. APP FEATURES ---
        function switchPage(pid, btn) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.add('hidden'));
            document.getElementById(pid).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(btn) btn.classList.add('active');

            // Auto load Level 1 and Stats if Team page is opened
            if(pid === 'pageTeam') {
                loadTeam(1);
                calculateTeamStats();
            }
        }

        // --- UPDATED TEAM LOGIC (Count Active Investors) ---
        function calculateTeamStats() {
            db.ref('users').once('value', snap => {
                const all = snap.val();
                if(!all) return;

                const myCode = currentUser.refCode;
                let l1 = [], l2 = [], l3 = [], l4 = [];

                // Find L1
                Object.values(all).forEach(u => {
                    if(u.refBy === myCode) l1.push(u);
                });

                // Find L2
                if(l1.length > 0) {
                    const l1Codes = l1.map(u => u.refCode);
                    Object.values(all).forEach(u => {
                        if(l1Codes.includes(u.refBy)) l2.push(u);
                    });
                }

                // Find L3
                if(l2.length > 0) {
                    const l2Codes = l2.map(u => u.refCode);
                    Object.values(all).forEach(u => {
                        if(l2Codes.includes(u.refBy)) l3.push(u);
                    });
                }

                // Find L4
                if(l3.length > 0) {
                    const l3Codes = l3.map(u => u.refCode);
                    Object.values(all).forEach(u => {
                        if(l3Codes.includes(u.refBy)) l4.push(u);
                    });
                }

                // Count INVESTORS (people with totalDep > 0)
                const countInv = (arr) => arr.filter(u => u.totalDep > 0).length;

                document.getElementById('countL1').innerText = `${countInv(l1)}/${l1.length}`;
                document.getElementById('countL2').innerText = `${countInv(l2)}/${l2.length}`;
                document.getElementById('countL3').innerText = `${countInv(l3)}/${l3.length}`;
                document.getElementById('countL4').innerText = `${countInv(l4)}/${l4.length}`;
            });
        }

        function loadTeam(lvl) {
            const list = document.getElementById('teamList');
            list.innerHTML = '<p style="text-align:center; color:#666;">Syncing Network Data...</p>';
            
            ['tabL1', 'tabL2', 'tabL3', 'tabL4'].forEach(id => {
                document.getElementById(id).classList.remove('active-tab');
                document.getElementById(id).style.color = 'var(--text-dim)';
            });
            
            const activeId = 'tabL' + lvl;
            document.getElementById(activeId).classList.add('active-tab');
            document.getElementById(activeId).style.color = 'var(--neon-blue)';

            db.ref('users').once('value', snap => {
                const all = snap.val();
                if(!all) { list.innerHTML = "<p style='text-align:center'>No Data</p>"; return; }
                
                const myCode = currentUser.refCode;
                let l1 = [], l2 = [], l3 = [], l4 = [];

                Object.values(all).forEach(u => {
                    if(u.refBy === myCode) l1.push(u);
                });

                if(lvl >= 2) {
                    const l1Codes = l1.map(u => u.refCode);
                    Object.values(all).forEach(u => {
                        if(l1Codes.includes(u.refBy)) l2.push(u);
                    });
                }

                if(lvl >= 3) {
                    const l2Codes = l2.map(u => u.refCode);
                    Object.values(all).forEach(u => {
                        if(l2Codes.includes(u.refBy)) l3.push(u);
                    });
                }

                if(lvl === 4) {
                    const l3Codes = l3.map(u => u.refCode);
                    Object.values(all).forEach(u => {
                        if(l3Codes.includes(u.refBy)) l4.push(u);
                    });
                }

                let final = (lvl === 1) ? l1 : (lvl === 2) ? l2 : (lvl === 3) ? l3 : l4;
                
                list.innerHTML = "";
                if(final.length === 0) {
                    list.innerHTML = `<p style="text-align:center; padding:20px; color:#666;">No members in Level ${lvl}</p>`;
                    return;
                }

                final.forEach(user => {
                    const d = new Date(user.joinDate).toLocaleDateString();
                    // Color code active vs inactive
                    const isActive = user.totalDep > 0;
                    const statusColor = isActive ? 'var(--neon-green)' : '#555';
                    const statusText = isActive ? 'Active Investor' : 'Registered';

                    list.innerHTML += `
                    <div style="background:rgba(255,255,255,0.05); padding:15px; margin-bottom:10px; border-radius:10px; display:flex; align-items:center; justify-content:space-between; border-left:3px solid ${isActive ? 'var(--neon-blue)' : '#333'};">
                        <div>
                            <div style="font-weight:bold; color:white;">+251 ${user.phone}</div>
                            <div style="font-size:0.8em; color:#777;">Joined: ${d}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="color:${statusColor}; font-size:0.9em;">${statusText}</div>
                            <div style="font-size:0.8em; color:#555;">L${lvl} Member</div>
                        </div>
                    </div>`;
                });
            });
        }

        function loadPlans() {
            // First fetch user investments to calculate limit
            db.ref('investments/u_' + currentUser.phone).once('value', invSnap => {
                const myInvs = invSnap.val() || {};
                const counts = {};
                Object.values(myInvs).forEach(inv => {
                    counts[inv.name] = (counts[inv.name] || 0) + 1;
                });

                // Then fetch Plans
                db.ref('plans').on('value', snap => {
                    const list = document.getElementById('plansList');
                    list.innerHTML = "";
                    const plans = snap.val();
                    if(!plans) { list.innerHTML = "No Nodes Available"; return; }

                    Object.keys(plans).forEach(k => {
                        const p = plans[k];
                        const days = p.days ? p.days : 180;
                        const totalReturn = p.daily * days;
                        
                        // LIMIT LOGIC
                        const limit = p.limit ? parseInt(p.limit) : 100; // Default high if no limit
                        const userCount = counts[p.name] || 0;
                        const isSoldOut = userCount >= limit;

                        let btnHtml = "";
                        if(isSoldOut) {
                            btnHtml = `<button class="btn-buy btn-buy-full" style="background:#333; color:#777; cursor:not-allowed;" disabled>SOLD OUT (Limit Reached)</button>`;
                        } else {
                            if (p.img) {
                                btnHtml = `<button class="btn-buy btn-buy-full" onclick="buyPlan('${p.name}', ${p.price}, ${p.daily}, ${days}, ${limit})">ACTIVATE NODE</button>`;
                            } else {
                                btnHtml = `<button class="btn-buy" onclick="buyPlan('${p.name}', ${p.price}, ${p.daily}, ${days}, ${limit})">ACTIVATE</button>`;
                            }
                        }

                        if (p.img) {
                            list.innerHTML += `
                            <div class="plan-card product-card">
                                <img src="${p.img}" class="plan-img">
                                <div class="product-info-box">
                                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                                        <div class="plan-title">${p.name}</div>
                                        <div style="color:var(--neon-blue); font-weight:bold; font-size:1.1em;">${p.daily} ETB/Day</div>
                                    </div>
                                    
                                    <div style="display:flex; justify-content:space-between; font-size:0.9em; color:#888; margin-bottom:5px;">
                                        <span>Cycle: <strong style="color:white;">${days} Days</strong></span>
                                        <span>Limit: ${userCount}/${limit}</span>
                                    </div>

                                    <div style="font-size:1em; color:white; margin-top:5px;">Price: <span style="color:var(--neon-purple);">${p.price} ETB</span></div>
                                </div>
                                <div class="product-btn-box">
                                    ${btnHtml}
                                </div>
                            </div>`;
                        } else {
                            list.innerHTML += `
                            <div class="plan-card">
                                <i class="fas fa-server plan-icon"></i>
                                <div class="plan-info">
                                    <div class="plan-title">${p.name}</div>
                                    <div class="plan-roi">Daily: ${p.daily} ETB | Cycle: ${days} Days</div>
                                    <div style="font-size:0.8em; color:var(--neon-green);">Total Profit: ${totalReturn} ETB</div>
                                    <div style="font-size:0.8em; color:#666;">Cost: ${p.price} ETB</div>
                                </div>
                                ${btnHtml}
                            </div>`;
                        }
                    });
                });
            });
        }

        // --- RECHARGE BONUS (10, 2, 1) - FIRST INVESTMENT BONUS ---
        function buyPlan(name, price, daily, days, limit) {
            // Re-check limit just in case
            db.ref('investments/u_' + currentUser.phone).orderByChild('name').equalTo(name).once('value', snap => {
                const count = snap.numChildren();
                if(count >= limit) {
                    showToast("PURCHASE LIMIT REACHED");
                    return;
                }

                if(currentUser.balance < price) { showToast("INSUFFICIENT FUNDS"); return; }
                if(confirm("Confirm activation of " + name + " for " + days + " days?")) {
                    const newBal = currentUser.balance - price;
                    db.ref('users/u_' + currentUser.phone).update({ balance: newBal });
                    
                    // SAVE TO INVESTMENTS FOR HISTORY (With Days)
                    db.ref('investments/u_' + currentUser.phone).push({
                        name, price, daily, days, date: Date.now()
                    });

                    // RECHARGE BONUS (First Investment Bonus): Based on Investment Amount (Price)
                    // L1: 10%, L2: 2%, L3: 1%
                    handleCommission(currentUser.refBy, price, 1);

                    showToast("NODE ACTIVATED");
                    setTimeout(() => loadPlans(), 1000); // Refresh UI to update limit count
                }
            });
        }

        // Recursive function to handle 3 levels of Recharge Bonus (Kept same as before)
        function handleCommission(refCode, price, level) {
            if(!refCode || refCode === "ROOT" || level > 3) return;

            let rate = 0;
            if(level === 1) rate = 0.10; // 10%
            if(level === 2) rate = 0.02; // 2%
            if(level === 3) rate = 0.01; // 1%

            const commAmount = price * rate;

            // Find the upline user by refCode
            db.ref('users').orderByChild('refCode').equalTo(refCode).once('value', snap => {
                if(snap.exists()) {
                    const key = Object.keys(snap.val())[0]; // Get the UID of the upline
                    const upline = snap.val()[key];

                    // Give them the commission (Recharge Bonus)
                    db.ref('users/' + key).update({ 
                        balance: (upline.balance || 0) + commAmount,
                        comm: (upline.comm || 0) + commAmount
                    });

                    // Move to the next level up (Upline's Upline)
                    handleCommission(upline.refBy, level + 1);
                }
            });
        }

        function openMyPlans() {
            openOverlay('myPlansOverlay');
            const list = document.getElementById('myActivePlansList');
            list.innerHTML = '<p style="text-align:center; color:#666;">Scanning network...</p>';
            
            db.ref('investments/u_' + currentUser.phone).once('value', snap => {
                list.innerHTML = "";
                let totalDaily = 0;
                let hasPlans = false;

                // 1. Calculate Total Daily Income & Render List
                if(snap.exists()) {
                    hasPlans = true;
                    snap.forEach(c => {
                        const p = c.val();
                        totalDaily += parseInt(p.daily);
                        const date = new Date(p.date).toLocaleDateString();
                        const days = p.days ? p.days : "Unlimited";
                        
                        list.innerHTML += `
                        <div class="plan-card" style="border-left-color: var(--neon-green);">
                            <i class="fas fa-microchip plan-icon" style="color:var(--neon-green);"></i>
                            <div class="plan-info">
                                <div class="plan-title">${p.name}</div>
                                <div class="plan-roi" style="color:var(--neon-green);">Generating: ${p.daily} ETB/Day</div>
                                <div style="font-size:0.8em; color:#888;">Bought: ${date} | Valid: ${days} Days</div>
                            </div>
                        </div>`;
                    });
                } else {
                    list.innerHTML = '<p style="text-align:center;">No active nodes found.</p>';
                }

                // 2. Logic for Claim Button
                // Time: 6:00 AM (12 Seat) to 10:00 AM (4 Seat)
                // In 24hr format: 06:00 - 10:00
                if (hasPlans && totalDaily > 0) {
                    const now = new Date();
                    const hour = now.getHours(); // 0-23
                    const todayStr = now.toDateString();

                    const isTime = (hour >= 6 && hour < 10);
                    const isCollected = (currentUser.lastMiningCollection === todayStr);

                    let btnHtml = '';

                    if (isCollected) {
                        btnHtml = `<button class="btn-cyber" style="background:#333; color:#777; border-color:#555; margin-bottom:15px;" disabled>
                            ALREADY COLLECTED (${todayStr})
                        </button>`;
                    } else if (!isTime) {
                        btnHtml = `<button class="btn-cyber" style="background:#333; color:#777; border-color:#555; margin-bottom:15px;" disabled>
                            COLLECTION TIME: 12:00 - 4:00 (Local)
                        </button>`;
                    } else {
                        btnHtml = `<button class="btn-cyber" onclick="claimDailyMining(${totalDaily})" style="margin-bottom:15px; box-shadow:0 0 15px var(--neon-green); color:black; background:var(--neon-green);">
                            CLAIM INCOME: ${totalDaily} ETB
                        </button>`;
                    }

                    // Prepend Button to List
                    list.innerHTML = btnHtml + list.innerHTML;
                }
            });
        }

        // --- NEW DAILY INCOME COMMISSION (6%, 2%, 1%, 1%) ---
        // This function runs when the user collects their daily income
        function claimDailyMining(amount) {
            const todayStr = new Date().toDateString();
            
            // Double check status to prevent console hacking
            if(currentUser.lastMiningCollection === todayStr) { return; }

            const newBal = (currentUser.balance || 0) + amount;
            const newToday = (currentUser.today || 0) + amount;

            db.ref('users/u_' + currentUser.phone).update({
                balance: newBal,
                today: newToday,
                lastMiningCollection: todayStr
            }).then(() => {
                showToast(`Collected ${amount} ETB!`);
                openMyPlans(); // Refresh UI

                // TRIGGER DAILY TEAM COMMISSION
                // L1: 6%, L2: 2%, L3: 1%, L4: 1%
                distributeDailyCommission(currentUser.refBy, amount, 1);
            });
        }

        // Helper function to distribute Daily Income Bonus
        function distributeDailyCommission(refCode, dailyAmount, level) {
            if(!refCode || refCode === "ROOT" || level > 4) return;

            let rate = 0;
            if(level === 1) rate = 0.06; // 6%
            if(level === 2) rate = 0.02; // 2%
            if(level === 3) rate = 0.01; // 1%
            if(level === 4) rate = 0.01; // 1%

            const bonus = dailyAmount * rate;

            // Database lookup to find the upline
            db.ref('users').orderByChild('refCode').equalTo(refCode).once('value', snap => {
                if(snap.exists()) {
                    const uid = Object.keys(snap.val())[0];
                    const uplineUser = snap.val()[uid];

                    // Add to balance and 'comm' (commission stats) - Does NOT deduct from original user
                    db.ref('users/' + uid).update({
                        balance: (uplineUser.balance || 0) + bonus,
                        comm: (uplineUser.comm || 0) + bonus
                    });

                    // Recursion for next level
                    distributeDailyCommission(uplineUser.refBy, dailyAmount, level + 1);
                }
            });
        }

        function openDeposit() { openOverlay('depositOverlay'); }

        function loadDepositMethods() {
            db.ref('settings/depositMethods').on('value', snap => {
                const container = document.getElementById('depositMethodButtons');
                container.innerHTML = "";
                const methods = snap.val();
                if(!methods) { container.innerHTML = "<p style='grid-column:span 2; text-align:center;'>No methods configured.</p>"; return; }
                Object.keys(methods).forEach(k => {
                    const m = methods[k];
                    const btn = document.createElement('button');
                    btn.className = 'btn-buy';
                    btn.innerText = m.name;
                    btn.onclick = () => selBank(m.name, m.num, m.holder);
                    container.appendChild(btn);
                });
            });
        }

        function selBank(name, num, holder) {
            selectedBankData = {name, num};
            document.getElementById('depBankName').innerText = name;
            document.getElementById('depAccNum').innerText = num;
            document.getElementById('depHolder').innerText = holder;
            document.getElementById('bankDetails').style.display = 'block';
        }
        function submitDeposit() {
            const amt = document.getElementById('depAmount').value;
            const tid = document.getElementById('depRef').value;
            if(!amt || !tid) { showToast("Missing Data"); return; }
            
            // UPDATED: Added Validation for 900 ETB
            if(parseInt(amt) < 900) { showToast("Minimum Deposit 900 ETB"); return; }

            db.ref('deposits').push({
                uid: "u_" + currentUser.phone,
                phone: currentUser.phone,
                amount: parseInt(amt),
                tid: tid,
                status: 'pending'
            });
            showToast("Processing Request...");
            closeOverlay('depositOverlay');
        }

        function openWithdraw() { 
            if(!currentUser.bank) { showToast("Bind Bank First"); openOverlay('bankOverlay'); return; }
            openOverlay('withdrawOverlay'); 
        }

        function submitWithdraw() {
            const amt = parseInt(document.getElementById('withAmount').value);
            const pass = document.getElementById('withPass').value;
            
            // UPDATED: Added Validation for 270 ETB
            if(amt < 270) { showToast("Minimum Withdraw 270 ETB"); return; }
            
            if(amt > currentUser.balance) { showToast("Low Balance"); return; }
            if(pass !== currentUser.wPass) { showToast("Wrong Password"); return; }
            
            // Deduct balance AND increment Total Withdraw
            const newWith = (currentUser.totalWith || 0) + amt;
            db.ref('users/u_' + currentUser.phone).update({ 
                balance: currentUser.balance - amt,
                totalWith: newWith
            });

            // Save to withdrawal history
            db.ref('withdrawals').push({
                uid: "u_" + currentUser.phone,
                amount: amt,
                status: 'pending',
                date: Date.now()
            });

            showToast("Withdrawal Queued");
            closeOverlay('withdrawOverlay');
        }

        // --- UPDATED HISTORY FUNCTION ---
        function openHistory() {
            openOverlay('historyOverlay');
            const depList = document.getElementById('list-deposits');
            const withList = document.getElementById('list-withdrawals');
            const invList = document.getElementById('list-investments');
            
            depList.innerHTML = '<small style="color:#666;">Loading...</small>';
            withList.innerHTML = '<small style="color:#666;">Loading...</small>';
            invList.innerHTML = '<small style="color:#666;">Loading...</small>';
            
            // 1. FETCH DEPOSITS
            db.ref('deposits').orderByChild('uid').equalTo('u_' + currentUser.phone).once('value', snap => {
                depList.innerHTML = "";
                if(!snap.exists()) { depList.innerHTML = "<small style='color:#666;'>No Deposits</small>"; }
                else {
                    const data = [];
                    snap.forEach(s => data.push(s.val()));
                    data.reverse().forEach(d => {
                        let color = d.status === 'approved' ? 'var(--neon-green)' : (d.status === 'rejected' ? 'red' : '#ffcc00');
                        depList.innerHTML += `
                        <div style="background:rgba(255,255,255,0.05); padding:10px; margin-bottom:5px; border-radius:5px; border-left:3px solid ${color};">
                            <div style="display:flex; justify-content:space-between;">
                                <span style="font-weight:bold; color:white;">+${d.amount} ETB</span>
                                <span style="color:${color}; font-size:0.8em; font-weight:bold;">${d.status.toUpperCase()}</span>
                            </div>
                            <div style="font-size:0.7em; color:#666;">TID: ${d.tid}</div>
                        </div>`;
                    });
                }
            });

            // 2. FETCH WITHDRAWALS
            db.ref('withdrawals').orderByChild('uid').equalTo('u_' + currentUser.phone).once('value', snap => {
                withList.innerHTML = "";
                if(!snap.exists()) { withList.innerHTML = "<small style='color:#666;'>No Withdrawals</small>"; }
                else {
                    const data = [];
                    snap.forEach(s => data.push(s.val()));
                    data.reverse().forEach(w => {
                        let status = w.status || 'pending';
                        let color = status === 'paid' ? 'var(--neon-green)' : (status === 'rejected' ? 'red' : '#bc13fe');
                        let date = w.date ? new Date(w.date).toLocaleDateString() : '---';
                        withList.innerHTML += `
                        <div style="background:rgba(255,255,255,0.05); padding:10px; margin-bottom:5px; border-radius:5px; border-left:3px solid ${color};">
                            <div style="display:flex; justify-content:space-between;">
                                <span style="font-weight:bold; color:white;">-${w.amount} ETB</span>
                                <span style="color:${color}; font-size:0.8em; font-weight:bold;">${status.toUpperCase()}</span>
                            </div>
                            <div style="font-size:0.7em; color:#666;">Date: ${date}</div>
                        </div>`;
                    });
                }
            });

            // 3. FETCH INVESTMENTS
            db.ref('investments/u_' + currentUser.phone).once('value', snap => {
                invList.innerHTML = "";
                if(!snap.exists()) { invList.innerHTML = "<small style='color:#666;'>No Investments</small>"; }
                else {
                    snap.forEach(c => {
                        const p = c.val();
                        const date = new Date(p.date).toLocaleDateString();
                        invList.innerHTML += `
                        <div style="background:rgba(255,255,255,0.05); padding:10px; margin-bottom:5px; border-radius:5px; border-left:3px solid var(--neon-blue);">
                            <div style="display:flex; justify-content:space-between;">
                                <span style="font-weight:bold; color:white;">${p.name}</span>
                                <span style="color:var(--neon-blue); font-size:0.8em;">${p.price} ETB</span>
                            </div>
                            <div style="font-size:0.7em; color:#666;">Bought: ${date}</div>
                        </div>`;
                    });
                }
            });
        }
        
        // --- SETTINGS JS ---
        function openSettings() { openOverlay('settingsOverlay'); }

        // --- TASKS LOGIC ---
        function openTasks() {
            // 1. Show overlay immediately with loading state
            openOverlay('tasksOverlay');
            
            // Reset UI
            document.getElementById('taskPercent').innerText = "0%";
            document.getElementById('taskLoader').style.setProperty('--percent', `transparent 0%`);
            document.getElementById('taskLoader').style.background = `conic-gradient(var(--neon-blue) 0%, #333 0)`;

            document.getElementById('btnClaimTask').classList.remove('active');
            document.getElementById('btnClaimTask').innerHTML = '<i class="fas fa-lock"></i> LOCKED';
            
            db.ref('users').once('value', snap => {
                const allUsers = snap.val();
                if(!allUsers) return;

                const myCode = currentUser.refCode;
                let validInvites = 0;

                // 2. Calculate Valid Referrals
                Object.values(allUsers).forEach(u => {
                    if(u.refBy === myCode && (u.totalDep > 0)) {
                        validInvites++;
                    }
                });

                // 3. Calculate Targets
                let currentLevel = currentUser.taskLevel || 0; 
                let targetInvites = (currentLevel + 1) * 10;
                let reward = 500 * Math.pow(1.8, currentLevel);
                reward = Math.floor(reward);

                taskRewardAmount = reward; // Save for claiming
                
                // 4. Update Visuals
                document.getElementById('taskDone').innerText = validInvites;
                document.getElementById('taskGoal').innerText = targetInvites;
                document.getElementById('taskRewardVal').innerText = reward.toLocaleString() + " ETB";

                // Calculate percentage (max 100%)
                let percent = Math.floor((validInvites / targetInvites) * 100);
                if(percent > 100) percent = 100;

                // Animate Circle
                document.getElementById('taskPercent').innerText = percent + "%";
                document.getElementById('taskLoader').style.background = `conic-gradient(var(--neon-blue) ${percent}%, #333 0)`;

                // 5. Enable Button if Target Reached
                if(validInvites >= targetInvites) {
                    taskIsReady = true;
                    const btn = document.getElementById('btnClaimTask');
                    btn.classList.add('active');
                    btn.innerHTML = `<i class="fas fa-gift"></i> CLAIM REWARD`;
                } else {
                    taskIsReady = false;
                }
            });
        }

        function claimTaskReward() {
            if(!taskIsReady) return;

            // Confirm Claim
            if(confirm(`Claim your ${taskRewardAmount} ETB reward?`)) {
                
                const newBal = (currentUser.balance || 0) + taskRewardAmount;
                const newToday = (currentUser.today || 0) + taskRewardAmount;
                const nextLevel = (currentUser.taskLevel || 0) + 1;

                db.ref('users/u_' + currentUser.phone).update({
                    balance: newBal,
                    today: newToday,
                    taskLevel: nextLevel
                }).then(() => {
                    showToast(`+${taskRewardAmount} ETB ADDED!`);
                    closeOverlay('tasksOverlay');
                    // Refresh Tasks to show next level
                    setTimeout(() => openTasks(), 500); 
                });
            }
        }

        function changeLoginPass() {
            const oldP = document.getElementById('setOldPass').value;
            const newP = document.getElementById('setNewPass').value;
            
            if(oldP !== currentUser.pass) { showToast("Wrong Current Password"); return; }
            if(newP.length < 4) { showToast("Password too short"); return; }
            
            db.ref('users/u_' + currentUser.phone).update({ pass: newP });
            showToast("Login Key Updated");
            document.getElementById('setOldPass').value = "";
            document.getElementById('setNewPass').value = "";
        }

        function changeWPass() {
            const newW = document.getElementById('setNewWPass').value;
            if(newW.length < 4) { showToast("PIN too short"); return; }
            
            db.ref('users/u_' + currentUser.phone).update({ wPass: newW });
            showToast("Withdraw PIN Set");
            document.getElementById('setNewWPass').value = "";
        }

        // --- GIFT REDEEM LOGIC ---
        function redeemGift() {
            const code = document.getElementById('giftCode').value.trim();
            if(!code) { showToast("Enter Code"); return; }

            db.ref('giftCodes/' + code).once('value', snap => {
                if(snap.exists() && snap.val().status === 'active') {
                    const amount = snap.val().amount;
                    
                    // Add to Balance and Today's Income
                    const newBal = currentUser.balance + amount;
                    const newToday = (currentUser.today || 0) + amount;

                    db.ref('users/u_' + currentUser.phone).update({
                        balance: newBal,
                        today: newToday
                    });

                    // Remove used code (One-time use)
                    db.ref('giftCodes/' + code).remove();

                    showToast("Redeemed " + amount + " ETB!");
                    closeOverlay('giftOverlay');
                } else {
                    showToast("Invalid or Expired Code");
                }
            });
        }

        function openOverlay(id) { document.getElementById(id).style.display = 'block'; }
        function closeOverlay(id) { document.getElementById(id).style.display = 'none'; }
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
        function saveBank() {
            const bank = {
                name: document.getElementById('bindName').value,
                num: document.getElementById('bindNum').value,
                type: document.getElementById('bindType').value
            };
            const wp = document.getElementById('bindWPass').value;
            db.ref('users/u_' + currentUser.phone).update({ bank: bank, wPass: wp });
            showToast("Data Linked");
            closeOverlay('bankOverlay');
        }
        function dailyCheckIn() {
            const today = new Date().toDateString();
            if(currentUser.lastCheck === today) { showToast("Already Checked In"); return; }
            
            // Add to Balance and Today's Income
            const newToday = (currentUser.today || 0) + 5;
            db.ref('users/u_' + currentUser.phone).update({ 
                balance: currentUser.balance + 5,
                today: newToday,
                lastCheck: today
            });
            showToast("+5 ETB Bonus");
        }
        
        function copyRef() {
            const baseUrl = window.location.href.split('?')[0];
            const refLink = `${baseUrl}?ref=${currentUser.refCode}`;
            
            navigator.clipboard.writeText(refLink).then(() => {
                showToast("Referral Link Copied!");
            }).catch(() => {
                const textArea = document.createElement("textarea");
                textArea.value = refLink;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("Copy");
                textArea.remove();
                showToast("Referral Link Copied!");
            });
        }

        // --- ADMIN FUNCTIONS ---
        function loadAdminData() {
            // LOAD PENDING DEPOSITS
            db.ref('deposits').on('value', snap => {
                const d = document.getElementById('admDepList');
                d.innerHTML = "";
                snap.forEach(c => {
                    const v = c.val();
                    if(v.status === 'pending') {
                        // ADDED: Reject Button
                        d.innerHTML += `<div style="border-bottom:1px solid #333; padding:5px; color:white;">
                            ${v.phone} - ${v.amount} ETB <br> TID: ${v.tid} 
                            <div style="margin-top:5px;">
                                <button class="btn-adm-approve" onclick="approveDep('${c.key}', '${v.uid}', ${v.amount})">Approve</button>
                                <button class="btn-adm-del" onclick="admRejectDeposit('${c.key}')">Reject</button>
                            </div>
                        </div>`;
                    }
                });
            });

            // LOAD PENDING WITHDRAWALS
            db.ref('withdrawals').on('value', snap => {
                const w = document.getElementById('admWithList');
                w.innerHTML = "";
                snap.forEach(c => {
                    const v = c.val();
                    if(v.status === 'pending') {
                        w.innerHTML += `
                        <div style="border-bottom:1px solid #333; padding:10px; color:white; background:#111; margin-bottom:5px;">
                            <div style="color:var(--neon-purple); font-weight:bold;">${v.amount} ETB</div>
                            <div style="font-size:0.8em; color:#888;">User: ${v.uid}</div>
                            <div style="margin-top:5px;">
                                <button class="btn-adm-approve" onclick="admApproveWithdraw('${c.key}')">Approve</button>
                                <button class="btn-adm-del" onclick="admRejectWithdraw('${c.key}', '${v.uid}', ${v.amount})">Reject & Refund</button>
                            </div>
                        </div>`;
                    }
                });
            });

            // Load Gift Codes in Admin
            db.ref('giftCodes').on('value', snap => {
                const list = document.getElementById('admGiftList');
                list.innerHTML = "";
                snap.forEach(c => {
                    const val = c.val();
                    if(val.status === 'active') {
                        list.innerHTML += `
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px; border-bottom:1px solid #333; padding:5px;">
                            <span style="color:yellow;">${c.key} (${val.amount} ETB)</span>
                            <button onclick="navigator.clipboard.writeText('${c.key}'); alert('Copied!')" style="cursor:pointer;">Copy</button>
                        </div>`;
                    }
                });
            });

            db.ref('settings/depositMethods').on('value', snap => {
                const list = document.getElementById('admBankList');
                list.innerHTML = "";
                const methods = snap.val();
                if(methods) {
                    Object.keys(methods).forEach(k => {
                        const m = methods[k];
                        list.innerHTML += `<div>${m.name} - ${m.num} <span style="color:red; cursor:pointer;" onclick="admDelBank('${k}')">[X]</span></div>`;
                    });
                }
            });

            db.ref('plans').on('value', snap => {
                const list = document.getElementById('admPlansList');
                list.innerHTML = "";
                snap.forEach(child => {
                    const p = child.val();
                    const key = child.key;
                    // SHOWING DETAILS IN ADMIN LIST
                    const days = p.days ? p.days : 180;
                    const limit = p.limit ? p.limit : "Unl";
                    
                    list.innerHTML += `
                    <div class="plan-item-admin">
                        <div>
                            <span style="color:var(--neon-blue); font-weight:bold;">${p.name}</span><br>
                            <span style="font-size:0.8em; color:#777;">${p.price} ETB | ${days}D | Limit: ${limit}</span>
                        </div>
                        <div>
                            <button class="btn-adm-edit" onclick="admEditPlan('${key}', '${p.name}', '${p.price}', '${p.daily}', '${p.img || ''}', '${days}', '${p.limit}')">Edit</button>
                            <button class="btn-adm-del" onclick="admDeletePlan('${key}')">Del</button>
                        </div>
                    </div>`;
                });
            });
        }
        
        // --- ADMIN GIFT GEN ---
        function admGenGift() {
            const amt = parseInt(document.getElementById('admGiftAmt').value);
            if(!amt) { alert("Enter Amount"); return; }
            
            const code = "HP-" + Math.random().toString(36).substring(2,8).toUpperCase();
            db.ref('giftCodes/' + code).set({ amount: amt, status: 'active' });
            alert("Code Generated: " + code);
            document.getElementById('admGiftAmt').value = "";
        }

        function approveDep(key, uid, amt) {
            db.ref('deposits/' + key).update({ status: 'approved' });
            db.ref('users/' + uid).once('value', s => {
                // Update Balance AND Total Recharge
                const curDep = s.val().totalDep || 0;
                db.ref('users/' + uid).update({ 
                    balance: s.val().balance + amt,
                    totalDep: curDep + amt
                });
            });
        }

        // --- NEW: REJECT DEPOSIT FUNCTION ---
        function admRejectDeposit(key) {
            if(confirm("Are you sure you want to REJECT this deposit?")) {
                db.ref('deposits/' + key).update({ status: 'rejected' });
                alert("Deposit Rejected.");
            }
        }

        // --- ADMIN WITHDRAWAL FUNCTIONS ---
        function admApproveWithdraw(key) {
            db.ref('withdrawals/' + key).update({ status: 'paid' });
            alert("Withdrawal Marked as PAID");
        }

        function admRejectWithdraw(key, uid, amount) {
            // 1. Mark as Rejected
            db.ref('withdrawals/' + key).update({ status: 'rejected' });
            
            // 2. REFUND THE USER
            db.ref('users/' + uid).once('value', snap => {
                if(snap.exists()) {
                    const u = snap.val();
                    // Give money back
                    const refundBal = (u.balance || 0) + parseInt(amount);
                    // Decrease Total Withdraw stats
                    const fixTotalWith = (u.totalWith || 0) - parseInt(amount);

                    db.ref('users/' + uid).update({
                        balance: refundBal,
                        totalWith: fixTotalWith
                    });
                    alert("Withdrawal Rejected. User Refunded " + amount + " ETB");
                }
            });
        }
        
        function admAddPlan() {
            const name = document.getElementById('admName').value;
            const img = document.getElementById('admImg').value;
            const price = parseInt(document.getElementById('admPrice').value);
            const daily = parseInt(document.getElementById('admDaily').value);
            const days = parseInt(document.getElementById('admDays').value); 
            const limit = parseInt(document.getElementById('admLimit').value); // NEW LIMIT

            if(!name || !price || !daily || !days) { alert("Missing Fields"); return; }

            const planData = {
                name: name,
                img: img,
                price: price,
                daily: daily,
                days: days,
                limit: limit || 100 // Default to 100 if empty
            };

            if (editingPlanId) {
                db.ref('plans/' + editingPlanId).update(planData);
                alert("Plan Updated Successfully");
                admCancelEdit(); 
            } else {
                db.ref('plans').push(planData);
                alert("New Plan Added");
                admCancelEdit(); 
            }
        }

        function admEditPlan(key, name, price, daily, img, days, limit) {
            editingPlanId = key;
            document.getElementById('admName').value = name;
            document.getElementById('admPrice').value = price;
            document.getElementById('admDaily').value = daily;
            document.getElementById('admImg').value = img;
            document.getElementById('admDays').value = days;
            document.getElementById('admLimit').value = limit; // LOAD LIMIT

            document.getElementById('btnSavePlan').innerText = "Update Plan";
            document.getElementById('btnSavePlan').style.background = "var(--neon-purple)";
            document.getElementById('btnCancelEdit').style.display = "block";
            
            document.getElementById('admName').scrollIntoView({ behavior: 'smooth' });
        }

        function admDeletePlan(key) {
            if(confirm("Are you sure you want to delete this plan?")) {
                db.ref('plans/' + key).remove();
            }
        }

        function admCancelEdit() {
            editingPlanId = null;
            document.getElementById('admName').value = "";
            document.getElementById('admImg').value = "";
            document.getElementById('admPrice').value = "";
            document.getElementById('admDaily').value = "";
            document.getElementById('admDays').value = "";
            document.getElementById('admLimit').value = ""; // CLEAR LIMIT
            
            document.getElementById('btnSavePlan').innerText = "Add New Plan";
            document.getElementById('btnSavePlan').style.background = "var(--neon-green)";
            document.getElementById('btnCancelEdit').style.display = "none";
        }

        function admAddBank() {
            const name = document.getElementById('admBankName').value;
            const num = document.getElementById('admBankNum').value;
            const holder = document.getElementById('admBankHolder').value;

            if(!name || !num || !holder) { alert("Fill all fields"); return; }

            db.ref('settings/depositMethods').push({ name, num, holder });
            alert("Payment Method Added");
            
            document.getElementById('admBankName').value = "";
            document.getElementById('admBankNum').value = "";
            document.getElementById('admBankHolder').value = "";
        }

        function admDelBank(key) {
            if(confirm("Delete this payment method?")) {
                db.ref('settings/depositMethods/' + key).remove();
            }
        }

    </script>
</body>
</html>
